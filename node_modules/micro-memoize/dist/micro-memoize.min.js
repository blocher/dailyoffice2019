!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self)["micro-memoize"]=t()}(this,function(){"use strict";var k={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},n=Array.prototype.slice;function A(e){var t=e.length;return t?1===t?[e[0]]:2===t?[e[0],e[1]]:3===t?[e[0],e[1],e[2]]:n.call(e,0):[]}function M(e,t){return e===t||e!=e&&t!=t}function O(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n}var S=(Object.defineProperty(e.prototype,"size",{get:function(){return this.keys.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"snapshot",{get:function(){return{keys:A(this.keys),size:this.size,values:A(this.values)}},enumerable:!0,configurable:!0}),e.prototype._getKeyIndexFromMatchingKey=function(e){var t=this.options,n=t.isMatchingKey,i=t.maxSize,o=this.keys,r=o.length;if(!r)return-1;if(n(o[0],e))return 0;if(1<i)for(var s=1;s<r;s++)if(n(o[s],e))return s;return-1},e.prototype._getKeyIndexForMany=function(e){var t=this.options.isEqual,n=this.keys,i=n.length;if(!i)return-1;if(1===i)return this._getKeyIndexForSingle(e);var o,r,s=e.length;if(1<s){for(var a=0;a<i;a++)if((o=n[a]).length===s){for(r=0;r<s&&t(o[r],e[r]);r++);if(r===s)return a}}else for(a=0;a<i;a++)if((o=n[a]).length===s&&t(o[0],e[0]))return a;return-1},e.prototype._getKeyIndexForSingle=function(e){var t=this.keys;if(!t.length)return-1;var n=t[0],i=n.length;if(e.length!==i)return-1;var o=this.options.isEqual;if(1<i){for(var r=0;r<i;r++)if(!o(n[r],e[r]))return-1;return 0}return o(n[0],e[0])?0:-1},e.prototype.orderByLru=function(e,t,n){for(var i=this.keys,o=this.values,r=i.length,s=n;s--;)i[s+1]=i[s],o[s+1]=o[s];i[0]=e,o[0]=t;var a=this.options.maxSize;r===a&&n===r?(i.pop(),o.pop()):a<=n&&(i.length=o.length=a)},e.prototype.updateAsyncCache=function(t){var n=this,e=this.options,i=e.onCacheChange,o=e.onCacheHit,r=this.keys[0],s=this.values[0];this.values[0]=s.then(function(e){return n.shouldUpdateOnHit&&o(n,n.options,t),n.shouldUpdateOnChange&&i(n,n.options,t),e},function(e){var t=n.getKeyIndex(r);throw-1!==t&&(n.keys.splice(t,1),n.values.splice(t,1)),e})},e);function e(e){this.keys=[],this.values=[];var t="function"==typeof(this.options=e).isMatchingKey;t?this.getKeyIndex=this._getKeyIndexFromMatchingKey:1<e.maxSize?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey="function"==typeof e.transformKey,this.shouldCloneArguments=this.canTransformKey||t,this.shouldUpdateOnAdd="function"==typeof e.onCacheAdd,this.shouldUpdateOnChange="function"==typeof e.onCacheChange,this.shouldUpdateOnHit="function"==typeof e.onCacheHit}return function e(o,t){if(void 0===t&&(t={}),function(e){return"function"==typeof e&&e.isMemoized}(o))return e(o.fn,O(o.options,t));if("function"!=typeof o)throw new TypeError("You must pass a function to `memoize`.");function r(){var e=K?A(arguments):arguments;C&&(e=p(e));var t=v.length?g.getKeyIndex(e):-1;if(-1!==t)I&&d(g,l,r),t&&(g.orderByLru(v[t],m[t],t),z&&y(g,l,r));else{var n=o.apply(this,arguments),i=K?e:A(arguments);g.orderByLru(i,n,v.length),h&&g.updateAsyncCache(r),x&&c(g,l,r),z&&y(g,l,r)}return m[0]}var n=t.isEqual,i=void 0===n?M:n,s=t.isMatchingKey,a=t.isPromise,h=void 0!==a&&a,u=t.maxSize,f=void 0===u?1:u,c=t.onCacheAdd,y=t.onCacheChange,d=t.onCacheHit,p=t.transformKey,l=O({isEqual:i,isMatchingKey:s,isPromise:h,maxSize:f,onCacheAdd:c,onCacheChange:y,onCacheHit:d,transformKey:p},function(e){var t={};for(var n in e)k[n]||(t[n]=e[n]);return t}(t)),g=new S(l),v=g.keys,m=g.values,C=g.canTransformKey,K=g.shouldCloneArguments,x=g.shouldUpdateOnAdd,z=g.shouldUpdateOnChange,I=g.shouldUpdateOnHit;return r.cache=g,r.fn=o,r.isMemoized=!0,r.options=l,r}});
