{"version":3,"sources":["../../src/nvm.js"],"names":["pExecFile","execFile","getNvmCustomAlias","alias","runNvmCommand","getNvmSystemVersion","command","env","NVM_DIR","nvmPath","stdout","trim"],"mappings":"mIAAA;AACA;AACA;AACA;;AAEA,+D;;AAEA,KAAMA,CAAAA,SAAS,CAAG,oBAAUC,uBAAV,CAAlB;;;AAGO,KAAMC,CAAAA,iBAAiB,CAAG,SAAUC,KAAV,CAAiB;AAChD,MAAOC,CAAAA,aAAa,CAAE,aAAYD,KAAM,EAApB,CAApB;AACD,CAFM,C;;;AAKA,KAAME,CAAAA,mBAAmB,CAAG,UAAY;AAC7C,MAAOD,CAAAA,aAAa,CAAC,6CAAD,CAApB;AACD,CAFM,C;;;AAKP,KAAMA,CAAAA,aAAa,CAAG,eAAgBE,OAAhB,CAAyB;AAC7C,GAAI,CAACC,aAAIC,OAAT,CAAkB;AAChB;AACD;;AAED,KAAMC,CAAAA,OAAO,CAAG,eAAKF,aAAIC,OAAT,CAAkB,QAAlB,CAAhB;;AAEA,GAAI,EAAE,KAAM,wBAAWC,OAAX,CAAR,CAAJ,CAAkC;AAChC;AACD;;AAED,GAAI;AACF,KAAM,CAAEC,MAAF,EAAa,KAAMV,CAAAA,SAAS,CAAC,MAAD,CAAS;AACzC,IADyC;AAExC,WAAUS,OAAQ,QAAOH,OAAQ,EAFO,CAAT,CAAlC;;AAIA,MAAOI,CAAAA,MAAM,CAACC,IAAP,EAAP;;;;;AAKD,CAAC,KAAM,CAAE;AACX,CAtBD","sourcesContent":["import { execFile } from 'child_process'\nimport { join } from 'path'\nimport { env } from 'process'\nimport { promisify } from 'util'\n\nimport pathExists from 'path-exists'\n\nconst pExecFile = promisify(execFile)\n\n// Retrieve nvm custom alias.\nexport const getNvmCustomAlias = function (alias) {\n  return runNvmCommand(`nvm_alias ${alias}`)\n}\n\n// Retrieve Node.js version outside nvm\nexport const getNvmSystemVersion = function () {\n  return runNvmCommand('nvm deactivate >/dev/null && node --version')\n}\n\n// nvm requires sourcing `nvm.sh` first\nconst runNvmCommand = async function (command) {\n  if (!env.NVM_DIR) {\n    return\n  }\n\n  const nvmPath = join(env.NVM_DIR, 'nvm.sh')\n\n  if (!(await pathExists(nvmPath))) {\n    return\n  }\n\n  try {\n    const { stdout } = await pExecFile('bash', [\n      '-c',\n      `source \"${nvmPath}\" && ${command}`,\n    ])\n    return stdout.trim()\n    // Among possible errors:\n    //   - Setup issue: Bash or nvm not installed, Bash setup error, etc.\n    //   - Custom alias: alias does not exist\n    //   - `system`: no system `node` outside `nvm`\n  } catch {}\n}\n"],"file":"src/nvm.js"}