"use strict";var _process=require("process");

var _offline=require("./cache/offline.js");
var _read=require("./cache/read.js");
var _fetch=require("./fetch.js");
var _normalize=require("./normalize.js");
var _options=require("./options.js");



const allNodeVersions=async function(opts){
const{fetch,...fetchNodeOpts}=(0,_options.getOpts)(opts);
const versionsInfo=await getAllVersions(fetch,fetchNodeOpts);
return versionsInfo;
};


const getAllVersions=async function(fetch,fetchNodeOpts){
if(
processCachedVersions!==undefined&&
fetch!==true&&
!_process.env.TEST_CACHE_FILENAME)
{
return processCachedVersions;
}

const versionsInfo=await getVersionsInfo(fetch,fetchNodeOpts);


processCachedVersions=versionsInfo;

return versionsInfo;
};


let processCachedVersions;


const getVersionsInfo=async function(fetch,fetchNodeOpts){
const cachedVersions=await(0,_read.readCachedVersions)(fetch);

if(cachedVersions!==undefined){
return cachedVersions;
}

try{
const index=await(0,_fetch.fetchIndex)(fetchNodeOpts);
const versionsInfo=(0,_normalize.normalizeIndex)(index);
await(0,_read.writeCachedVersions)(versionsInfo);
return versionsInfo;
}catch(error){
return(0,_offline.handleOfflineError)(error);
}
};



module.exports=allNodeVersions;
//# sourceMappingURL=main.js.map