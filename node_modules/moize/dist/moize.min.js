!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).moize={})}(this,function(e){"use strict";var i=Object.prototype.hasOwnProperty,O=function(e){for(var n,t=0;t<(arguments.length<=1?0:arguments.length-1);t++)if((n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1])&&"object"==typeof n)for(var r in n)i.call(n,r)&&(e[r]=n[r]);return e},E=function(e){var n=e.length;if(!n)return[];if(1===n)return[e[0]];if(2===n)return[e[0],e[1]];if(3===n)return[e[0],e[1],e[2]];for(var t=new Array(n),r=0;r<n;r++)t[r]=e[r];return t},j=function(e,n){var r="function"==typeof n?n:function(i){return function(e,n){if(e.length!==n.length)return!1;for(var t=0,r=e.length;t<r;t++)if(!i(e[t],n[t]))return!1;return!0}}(e);return function(e,n){for(var t=0;t<e.length;t++)if(r(e[t],n))return t;return-1}},M=function(e,n){return e===n||e!=e&&n!=n},P=function(e,n,t){},q=function(e,n,t){for(var r=t;r--;)e[r+1]=e[r];e[0]=n},K=function(i){var o=j(i.isEqual,i.isMatchingKey);return function(t,n){var r=t.keys[0];t.values[0]=t.values[0].then(function(e){return i.onCacheHit(t,i,n),i.onCacheChange(t,i,n),e}).catch(function(e){var n=o(t.keys,r);throw~n&&(t.keys.splice(n,1),t.values.splice(n,1)),e})}};function y(a,e){if(a.isMemoized)return a;var n=e||{},t=n.isEqual,r=void 0===t?M:t,i=n.isMatchingKey,o=n.isPromise,u=void 0!==o&&o,c=n.maxSize,s=void 0===c?1:c,f=n.onCacheAdd,l=void 0===f?P:f,h=n.onCacheChange,p=void 0===h?P:h,g=n.onCacheHit,v=void 0===g?P:g,y=n.transformKey,d=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],0<=n.indexOf(t)||(i[t]=e[t]);return i}(n,["isEqual","isMatchingKey","isPromise","maxSize","onCacheAdd","onCacheChange","onCacheHit","transformKey"]),m=O({},d,{isEqual:r,isMatchingKey:i,isPromise:u,maxSize:s,onCacheAdd:l,onCacheChange:p,onCacheHit:v,transformKey:y}),x=j(r,i),C=K(m),S=!(!y&&!i),z={keys:[],get size(){return z.keys.length},values:[]},A=z.keys,b=z.values;function k(){var e=arguments,n=S?E(e):e,t=y?y(n):n,r=x(A,t);if(~r)v(z,m,k),r&&(q(A,A[r],r),q(b,b[r],r),p(z,m,k));else{A.length>=s&&(A.pop(),b.pop());var i=S?t:E(n),o=a.apply(this,e);q(A,i,A.length),q(b,o,b.length),u&&C(z,k),l(z,m,k),p(z,m,k)}return b[0]}return Object.defineProperties(k,{cache:{configurable:!0,get:function(){return z}},cacheSnapshot:{configurable:!0,get:function(){return{keys:E(z.keys),size:z.size,values:E(z.values)}}},isMemoized:{configurable:!0,get:function(){return!0}},options:{configurable:!0,get:function(){return m}}}),k}function o(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length)return n.reduce(function(e,n){return"function"==typeof e?"function"==typeof n?function(){return e(n.apply(this,arguments))}:e:"function"==typeof n?n:void 0})}function p(e,n){for(var t=0;t<e.length;t++)if(e[t].key===n)return t;return-1}function g(r,e){var i="function"==typeof e?e:function(e,n){for(var t=0;t<n.length;t++)if(!r(e[t],n[t]))return!1;return!0};return function(e,n){for(var t=0;t<e.length;t++)if(e[t].length===n.length&&i(e[t],n))return t;return-1}}function a(e){return Array.isArray(e)?e:[e]}function v(e,n,t){var r=p(e,n);~r&&(clearTimeout(e[r].timeoutId),t&&e.splice(r,1))}function d(e,n){var t=setTimeout(e,n);return"function"==typeof t.unref&&t.unref(),t}function n(){h.isCollectingStats=!0}function r(e,n){return e?(n/e*100).toFixed(4)+"%":"0%"}function f(e){if(h.isCollectingStats||R||(console.warn('Stats are not currently being collected, please run "collectStats" to enable them.'),R=!0),e){if(!h.profiles[e])return{calls:0,hits:0,usage:"0%"};var n=h.profiles[e];return Object.assign({},n,{usage:r(n.calls,n.hits)})}var t=Object.keys(h.profiles).reduce(function(e,n){return e.calls+=h.profiles[n].calls,e.hits+=h.profiles[n].hits,e},{calls:0,hits:0});return Object.assign({},t,{profiles:Object.keys(h.profiles).reduce(function(e,n){return e[n]=f(n),e},{}),usage:r(t.calls,t.hits)})}function u(e,n){return e&&"object"==typeof e&&n.add(e)}function m(e,n,t,r){for(var i,o=0;o<e.length;o++)if(t((i=e[o])[0],n[0],r)&&t(i[1],n[1],r))return!0;return!1}function x(e,n,t,r){for(var i=0;i<e.length;i++)if(t(e[i],n,r))return!0;return!1}function C(e,n){return e===n||e!=e&&n!=n}function S(e){return e.constructor===Object}function z(e){return"function"==typeof e.then}function c(e){return!(!e.$$typeof||!e._store)}function t(n){return function(e){var o=n||e;return function(e,n,t){void 0===t&&(t=W?new WeakSet:Object.create({_values:[],add:function(e){this._values.push(e)},has:function(e){return!!~this._values.indexOf(e)}}));var r=t.has(e),i=t.has(n);return r||i?r&&i:(u(e,t),u(n,t),o(e,n,t))}}}function A(e){var t=[];return e.forEach(function(e,n){return t.push([n,e])}),t}function b(e){var n=[];return e.forEach(function(e){return n.push(e)}),n}function k(e,n,t,r){var i,o=$(e),a=$(n);if(o.length!==a.length)return!1;for(var u=0;u<o.length;u++){if(i=o[u],!x(a,i,C))return!1;if(("_owner"!==i||!c(e)||!c(n))&&!t(e[i],n[i],r))return!1}return!0}function s(e){var g="function"==typeof e?e(n):n;function n(e,n,t){if(C(e,n))return!0;var r=typeof e;if(r!=typeof n||"object"!=r||!e||!n)return!1;if(S(e)&&S(n))return k(e,n,g,t);var i=B(e),o=B(n);if(i||o)return i===o&&function(e,n,t,r){if(e.length!==n.length)return!1;for(var i=0;i<e.length;i++)if(!t(e[i],n[i],r))return!1;return!0}(e,n,g,t);var a=e instanceof Date,u=n instanceof Date;if(a||u)return a==u&&C(e.getTime(),n.getTime());var c=e instanceof RegExp,s=n instanceof RegExp;if(c||s)return c==s&&function(e,n){return e.source===n.source&&e.global===n.global&&e.ignoreCase===n.ignoreCase&&e.multiline===n.multiline&&e.unicode===n.unicode&&e.sticky===n.sticky&&e.lastIndex===n.lastIndex}(e,n);if(z(e)||z(n))return e===n;if(I){var f=e instanceof Map,l=n instanceof Map;if(f||l)return f==l&&function(e,n,t,r){if(e.size!==n.size)return!1;for(var i=A(e),o=A(n),a=0;a<i.length;a++)if(!m(o,i[a],t,r)||!m(i,o[a],t,r))return!1;return!0}(e,n,g,t)}if(J){var h=e instanceof Set,p=n instanceof Set;if(h||p)return h==p&&function(e,n,t,r){if(e.size!==n.size)return!1;for(var i=b(e),o=b(n),a=0;a<i.length;a++)if(!x(o,i[a],t,r)||!x(i,o[a],t,r))return!1;return!0}(e,n,g,t)}return k(e,n,g,t)}return n}function l(n){return function(e){if(n>=e.length)return e;switch(n){case 0:return[];case 1:return[e[0]];case 2:return[e[0],e[1]];case 3:return[e[0],e[1],e[2]];case 4:return[e[0],e[1],e[2],e[3]];case 5:return[e[0],e[1],e[2],e[3],e[4]]}return Array.prototype.slice.call(e,0,n)}}var N={equals:void 0,isDeepEqual:!1,isPromise:!1,isReact:!1,isSerialized:!1,matchesKey:void 0,maxAge:void 0,maxArgs:void 0,maxSize:1/0,onExpire:void 0,profileName:void 0,serializer:void 0,shouldSerializeFunctions:!1,transformArgs:void 0,updateExpire:!1},H=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length)return n.reduce(function(e,n){return"function"==typeof e?"function"==typeof n?function(){n.apply(this,arguments),e.apply(this,arguments)}:e:"function"==typeof n?n:void 0})},w=function(e,n){return n===N?e:Object.assign({},e,n,{onCacheAdd:H(e.onCacheAdd,n.onCacheAdd),onCacheChange:H(e.onCacheChange,n.onCacheChange),onCacheHit:H(e.onCacheHit,n.onCacheHit),transformArgs:o(e.transformArgs,n.transformArgs)})},F=function(e,n,t,r){var i=n.maxAge,o=n.updateExpire,a="number"==typeof i&&isFinite(i)?function a(u,c,s,e){var n=c.maxAge,f=c.onCacheChange,l=c.onExpire,h=g(s,e);return function(t,r,i){var o=t.keys[0];if(!~p(u,o)){var e=function(){var e=h(t.keys,o),n=t.values[e];~e&&(t.keys.splice(e,1),t.values.splice(e,1),"function"==typeof f&&f(t,r,i)),v(u,o,!0),"function"==typeof l&&!1===l(o)&&(t.keys.unshift(o),t.values.unshift(n),a(u,c,s)(t,r,i),"function"==typeof f&&f(t,r,i))};u.push({expirationMethod:e,key:o,timeoutId:d(e,n)})}}}(e,n,t,r):void 0;return{onCacheAdd:a,onCacheHit:a&&o?function(r,e){var i=e.maxAge;return function(e){var n=e.keys[0],t=p(r,n);~t&&(v(r,n,!1),r[t].timeoutId=d(r[t].expirationMethod,i))}}(e,n):void 0}},h={anonymousProfileNameCounter:1,isCollectingStats:!1,profiles:{}},R=!1,T=function(e){var n=(new Error).stack,t=e.displayName||e.name||"Anonymous "+h.anonymousProfileNameCounter++;if(!n)return t;for(var r,i,o=n.split("\n").slice(3),a=0;a<o.length;a++)if(!~(r=o[a]).indexOf("/moize/")&&!~r.indexOf(" (native)")&&!~r.indexOf(" Function.")){i=r.replace(/\n/g,"\\n").trim();break}return i?t+" "+i:t},_=function(e){return h.isCollectingStats?{onCacheAdd:function(e){var n=e.profileName;return h.profiles[n]||(h.profiles[n]={calls:0,hits:0}),function(){h.profiles[n].calls++}}(e),onCacheHit:function(e){var n=e.profileName;return function(){h.profiles[n].calls++,h.profiles[n].hits++}}(e)}:{}},D=function(e,n){return function(i,e){var r=e.expirations,n=i.options,t=n.isEqual,o=n.isMatchingKey,a=n.onCacheAdd,u=n.onCacheChange,c=n.transformKey,s=g(t,o);i.add=function(e,n){var t=c?c(e):e;~s(i.cache.keys,t)||(i.cache.size>=i.options.maxSize&&(i.cache.keys.pop(),i.cache.values.pop()),i.cache.keys.unshift(t),i.cache.values.unshift(n),a(i.cache,i.options,i),u(i.cache,i.options,i))},i.clear=function(){i.cache.keys.length=0,i.cache.values.length=0,u(i.cache,i.options,i)},i.get=function(e){var n=s(i.cache.keys,c?c(e):e);return~n?i.apply(this,i.cache.keys[n]):void 0},i.getStats=function(){var e=i.options.profileName;return f(e)},i.has=function(e){return!!~s(i.cache.keys,c?c(e):e)},i.keys=function(){return i.cacheSnapshot.keys},i.remove=function(e){var n=s(i.cache.keys,c?c(e):e);if(~n){var t=i.cache.keys[n];i.cache.keys.splice(n,1),i.cache.values.splice(n,1),u(i.cache,i.options,i),v(r,t,!0)}},i.update=function(e,n){var t=s(i.cache.keys,c?c(e):e);if(~t){var r=i.cache.keys[t];q(i.cache.keys,r,t),q(i.cache.values,n,t),u(i.cache,i.options,i)}},i.values=function(){return i.cacheSnapshot.values}}(e,n),function(e,n){var t=n.expirations,r=n.options,i=n.originalFunction,o=e.options;Object.defineProperties(e,{_microMemoizeOptions:{configurable:!0,get:function(){return o}},expirations:{configurable:!0,get:function(){return t}},expirationsSnapshot:{configurable:!0,get:function(){return t.slice(0)}},isCollectingStats:{configurable:!0,get:function(){return h.isCollectingStats}},isMoized:{configurable:!0,get:function(){return!0}},options:{configurable:!0,get:function(){return r}},originalFunction:{configurable:!0,get:function(){return i}}}),r.isReact&&(e.contextTypes=i.contextTypes,e.defaultProps=i.defaultProps,e.displayName="Moized("+(i.displayName||i.name||"Component")+")",e.propTypes=i.propTypes)}(e,n),e},I="function"==typeof Map,J="function"==typeof Set,W="function"==typeof WeakSet,$=Object.keys,B=Array.isArray,G=(s(t()),s(t(C)),s()),L=s(function(){return C});function Q(e,n,t){return"[ref-"+t+"]"}var U=function(e,n){if(e[0]===n)return 0;for(var t=e.length,r=1;r<t;r++)if(e[r]===n)return r;return-1};function V(i,e){var o=e||Q,a="function"==typeof i,u=[];return function(e,n){if("object"==typeof n)if(u.length){var t=U(u,this)+1;t?u=function(e,n){for(var t=new Array(n),r=0;r<n;r++)t[r]=e[r];return t}(u,t):u[u.length]=this;var r=U(u,n);if(~r)return o.call(this,e,n,r)}else u[0]=n;return a?i.call(this,e,n):n}}function X(e,n){return"function"==typeof n?""+n:n}function Y(n,t){try{return JSON.stringify(n,t)}catch(e){return function(e,n,t,r){return JSON.stringify(e,V(n,r),t)}(n,t)}}function Z(e){return"function"==typeof e.serializer?o(a,e.serializer):function(e){var a=e.shouldSerializeFunctions?X:null;return function(e){for(var n,t,r,i="|",o=0;o<e.length;o++)i+=(n=e[o],t=a,void 0,r=typeof n,(!n||"object"!=r&&"function"!=r?n:Y(n,t))+"|");return[i]}}(e)}function ee(e,n){return e[0]===n[0]}var ne=function(r){if("function"==typeof r)return function(e,n,t){return r(t.cache,t.options,t)}},te=function(e){var n=e.equals,t=e.isDeepEqual,r=e.isReact;return n||t&&G||r&&L||C},re=function(e){var n=e.isSerialized;return e.matchesKey||n&&ee||void 0},ie=function(e){var n=e.maxArgs,t=e.isReact,r=e.isSerialized,i=e.transformArgs;return o(r&&Z(e),"function"==typeof i&&o(a,i),t&&l(2),"number"==typeof n&&l(n))};function oe(t,e){if(void 0===e&&(e=N),t.isMoized)return oe(t.originalFunction,w(t.options,e));if("object"==typeof t)return function(e,n){return void 0===n&&(n={}),"function"==typeof e?oe(e,w(t,n)):oe(w(t,e))};var n=Object.assign({},N,e,{maxArgs:"number"==typeof e.maxArgs&&0<=e.maxArgs?e.maxArgs:N.maxArgs,maxSize:"number"==typeof e.maxSize&&0<=e.maxSize?e.maxSize:N.maxSize,profileName:e.profileName||T(t)}),r=[],i=(n.equals,n.isDeepEqual,n.isPromise),o=(n.isReact,n.isSerialized,n.matchesKey,n.maxAge,n.maxArgs,n.maxSize),a=n.onCacheAdd,u=n.onCacheChange,c=n.onCacheHit,s=(n.onExpire,n.profileName,n.shouldSerializeFunctions,n.serializer,n.transformArgs,n.updateExpire,function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],0<=n.indexOf(t)||(i[t]=e[t]);return i}(n,["equals","isDeepEqual","isPromise","isReact","isSerialized","matchesKey","maxAge","maxArgs","maxSize","onCacheAdd","onCacheChange","onCacheHit","onExpire","profileName","shouldSerializeFunctions","serializer","transformArgs","updateExpire"])),f=te(n),l=re(n),h=F(r,n,f,l),p=_(n),g=ie(n),v=Object.assign({},s,{isEqual:f,isMatchingKey:l,isPromise:i,maxSize:o,onCacheAdd:ne(H(a,h.onCacheAdd,p.onCacheAdd)),onCacheChange:ne(u),onCacheHit:ne(H(c,h.onCacheHit,p.onCacheHit)),transformKey:g});return D(y(t,v),{expirations:r,options:n,originalFunction:t})}oe.collectStats=n,oe.compose=function(){return o.apply(null,arguments)||oe},oe.deep=oe({isDeepEqual:!0}),oe.getStats=f,oe.isCollectingStats=function(){return h.isCollectingStats},oe.isMoized=function(e){return"function"==typeof e&&!!e.isMoized},oe.maxAge=function(e){return oe({maxAge:e})},oe.maxArgs=function(e){return oe({maxArgs:e})},oe.maxSize=function(e){return oe({maxSize:e})},oe.promise=oe({isPromise:!0,updateExpire:!0}),oe.react=oe({isReact:!0}),oe.reactSimple=oe({isReact:!0,maxSize:1}),oe.serialize=oe({isSerialized:!0}),oe.simple=oe({maxSize:1}),e.collectStats=n,e.default=oe,Object.defineProperty(e,"__esModule",{value:!0})});
