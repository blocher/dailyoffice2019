!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("micro-memoize"),require("fast-equals")):"function"==typeof define&&define.amd?define(["micro-memoize","fast-equals"],n):(e="undefined"!=typeof globalThis?globalThis:e||self).moize=n(e.memoize,e.fe)}(this,(function(e,n){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e);function i(){return(i=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var o={isDeepEqual:!1,isPromise:!1,isReact:!1,isSerialized:!1,isShallowEqual:!1,matchesArg:void 0,matchesKey:void 0,maxAge:void 0,maxArgs:void 0,maxSize:1,onExpire:void 0,profileName:void 0,serializer:void 0,updateCacheForKey:void 0,transformArgs:void 0,updateExpire:!1};function a(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce((function(e,n){return"function"==typeof e?"function"==typeof n?function(){e.apply(this,arguments),n.apply(this,arguments)}:e:"function"==typeof n?n:void 0}))}function u(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce((function(e,n){return"function"==typeof e?"function"==typeof n?function(){return e(n.apply(this,arguments))}:e:"function"==typeof n?n:void 0}))}function s(e,n){for(var t=0;t<e.length;t++)if(e[t].key===n)return t;return-1}function c(e,n){var t="function"==typeof n?n:function(n,t){for(var r=0;r<t.length;r++)if(!e(n[r],t[r]))return!1;return!0};return function(e,n){for(var r=0;r<e.length;r++)if(e[r].length===n.length&&t(e[r],n))return r;return-1}}function f(e,n){return n&&n!==o?i({},e,n,{onCacheAdd:a(e.onCacheAdd,n.onCacheAdd),onCacheChange:a(e.onCacheChange,n.onCacheChange),onCacheHit:a(e.onCacheHit,n.onCacheHit),transformArgs:u(e.transformArgs,n.transformArgs)}):e}function l(e,n,t){try{var r=t||n||"anonymous";Object.defineProperty(e,"name",{configurable:!0,enumerable:!1,value:"moized("+r+")",writable:!0})}catch(e){}}function p(e,n,t){var r=s(e,n);-1!==r&&(clearTimeout(e[r].timeoutId),t&&e.splice(r,1))}function m(e,n){var t=setTimeout(e,n);return"function"==typeof t.unref&&t.unref(),t}function h(e,n){return function(t){var r=t.keys[0],i=s(e,r);~i&&(p(e,r,!1),e[i].timeoutId=m(e[i].expirationMethod,n.maxAge))}}function g(e,n,t,r){var i="number"==typeof n.maxAge&&isFinite(n.maxAge)?function(e,n,t,r){var i=n.maxAge;return function o(a,u,f){var l=a.keys[0];if(-1===s(e,l)){var h=function(){var i=c(t,r)(a.keys,l),s=a.values[i];~i&&(a.keys.splice(i,1),a.values.splice(i,1),"function"==typeof n.onCacheChange&&n.onCacheChange(a,u,f)),p(e,l,!0),"function"==typeof n.onExpire&&!1===n.onExpire(l)&&(a.keys.unshift(l),a.values.unshift(s),o(a,u,f),"function"==typeof n.onCacheChange&&n.onCacheChange(a,u,f))};e.push({expirationMethod:h,key:l,timeoutId:m(h,i)})}}}(e,n,t,r):void 0;return{onCacheAdd:i,onCacheHit:i&&n.updateExpire?h(e,n):void 0}}var y={anonymousProfileNameCounter:1,isCollectingStats:!1,profiles:{}},d=!1;function v(e){e?delete y.profiles[e]:y.profiles={}}function x(e){var n=e.profileName;return function(){n&&!y.profiles[n]&&(y.profiles[n]={calls:0,hits:0}),y.profiles[n].calls++}}function C(e){return function(){var n=y.profiles,t=e.profileName;n[t]||(n[t]={calls:0,hits:0}),n[t].calls++,n[t].hits++}}function A(e){var n=(new Error).stack,t=e.displayName||e.name||"Anonymous "+y.anonymousProfileNameCounter++;if(!n)return t;for(var r,i,o=n.split("\n").slice(3),a=0;a<o.length;a++)if(-1===(r=o[a]).indexOf("/moize/")&&-1===r.indexOf(" (native)")&&-1===r.indexOf(" Function.")){i=r.replace(/\n/g,"\\n").trim();break}return i?t+" "+i:t}function z(e,n){return e?(n/e*100).toFixed(4)+"%":"0.0000%"}function S(e){y.isCollectingStats||d||(console.warn('Stats are not currently being collected, please run "collectStats" to enable them.'),d=!0);var n=y.profiles;if(e){if(!n[e])return{calls:0,hits:0,usage:"0.0000%"};var t=n[e];return i({},t,{usage:z(t.calls,t.hits)})}var r=Object.keys(y.profiles).reduce((function(e,t){return e.calls+=n[t].calls,e.hits+=n[t].hits,e}),{calls:0,hits:0});return i({},r,{profiles:Object.keys(n).reduce((function(e,n){return e[n]=S(n),e}),{}),usage:z(r.calls,r.hits)})}var b={arguments:!0,callee:!0,caller:!0,constructor:!0,length:!0,name:!0,prototype:!0};function E(e,n,t){void 0===t&&(t=[]),Object.getOwnPropertyNames(e).forEach((function(r){if(!b[r]&&-1===t.indexOf(r)){var i=Object.getOwnPropertyDescriptor(e,r);i.get||i.set?Object.defineProperty(n,r,i):n[r]=e[r]}}))}function k(e,n){return function(e,n){var t=n.expirations,r=e.options,i=c(r.isEqual,r.isMatchingKey),o=e;o.clear=function(){var e=o._microMemoizeOptions.onCacheChange,n=o.cache;return n.keys.length=0,n.values.length=0,e&&e(n,o.options,o),!0},o.clearStats=function(){v(o.options.profileName)},o.get=function(e){var n=o._microMemoizeOptions.transformKey,t=o.cache,r=n?n(e):e;return-1!==i(t.keys,r)?o.apply(this,e):void 0},o.getStats=function(){return S(o.options.profileName)},o.has=function(e){var n=o._microMemoizeOptions.transformKey,t=n?n(e):e;return-1!==i(o.cache.keys,t)},o.keys=function(){return o.cacheSnapshot.keys},o.remove=function(e){var n=o._microMemoizeOptions,r=n.onCacheChange,a=n.transformKey,u=o.cache,s=i(u.keys,a?a(e):e);if(-1===s)return!1;var c=u.keys[s];return u.keys.splice(s,1),u.values.splice(s,1),r&&r(u,o.options,o),p(t,c,!0),!0},o.set=function(e,n){var t=o._microMemoizeOptions,r=o.cache,a=o.options,u=t.onCacheAdd,s=t.onCacheChange,c=t.transformKey,f=c?c(e):e,l=i(r.keys,f);if(-1===l){var p=a.maxSize-1;r.size>p&&(r.keys.length=p,r.values.length=p),r.keys.unshift(f),r.values.unshift(n),a.isPromise&&r.updateAsyncCache(o),u&&u(r,a,o),s&&s(r,a,o)}else{var m=r.keys[l];r.values[l]=n,l>0&&r.orderByLru(m,n,l),a.isPromise&&r.updateAsyncCache(o),"function"==typeof s&&s(r,a,o)}},o.values=function(){return o.cacheSnapshot.values}}(e,n),function(e,n){var t=n.expirations,r=n.options,i=n.originalFunction,o=e.options;Object.defineProperties(e,{_microMemoizeOptions:{configurable:!0,get:function(){return o}},cacheSnapshot:{configurable:!0,get:function(){var n=e.cache;return{keys:n.keys.slice(0),size:n.size,values:n.values.slice(0)}}},expirations:{configurable:!0,get:function(){return t}},expirationsSnapshot:{configurable:!0,get:function(){return t.slice(0)}},isMoized:{configurable:!0,get:function(){return!0}},options:{configurable:!0,get:function(){return r}},originalFunction:{configurable:!0,get:function(){return i}}}),E(i,e)}(e,n),e}var O="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function N(e,n){for(var t=e.length,r=0;r<t;++r)if(e[r]===n)return r+1;return 0}function q(e){var n,t,r=typeof e;return!e||"object"!==r&&"function"!==r?e:JSON.stringify(e,(n=[],t=[],function(e,r){var i=typeof r;if("function"===i||"symbol"===i)return r.toString();if("object"==typeof r){if(n.length){var o=N(n,this);0===o?n[n.length]=this:(n.splice(o),t.splice(o)),t[t.length]=e;var a=N(n,r);if(0!==a)return"[ref="+(t.slice(0,a).join(".")||".")+"]"}else n[0]=r,t[0]=e;return r}return""+r}))}function w(e){for(var n="|",t=0;t<e.length;t++)n+=q(e[t])+"|";return[n]}function K(e,n){return e[0]===n[0]}function j(e){if("function"==typeof e)return function(n,t,r){return e(r.cache,r.options,r)}}function M(e){return u(e.isSerialized&&function(e){return"function"==typeof e.serializer?e.serializer:w}(e),"function"==typeof e.transformArgs&&e.transformArgs,"number"==typeof e.maxArgs&&(n=e.maxArgs,function(e){if(n>=e.length)return e;if(0===n)return[];if(1===n)return[e[0]];if(2===n)return[e[0],e[1]];if(3===n)return[e[0],e[1],e[2]];for(var t=[],r=0;r<n;r++)t[r]=e[r];return t}));var n}var P=["matchesArg","isDeepEqual","isPromise","isReact","isSerialized","isShallowEqual","matchesKey","maxAge","maxArgs","maxSize","onCacheAdd","onCacheChange","onCacheHit","onExpire","profileName","serializer","updateCacheForKey","transformArgs","updateExpire"],F=function e(t,u){var s=u||o;if(function(e){return"function"==typeof e&&e.isMoized}(t)){var c=t.originalFunction,p=f(t.options,s);return e(c,p)}if("object"==typeof t)return function(n,r){if("function"==typeof n){var i=f(t,r);return e(n,i)}var o=f(t,n);return e(o)};if(s.isReact)return function(e,n,t){var r=e(i({maxArgs:2,isShallowEqual:!0},t,{isReact:!1}));function o(e,t,i){this.props=e,this.context=t,this.updater=i,this.MoizedComponent=r(n)}return n.displayName||(n.displayName=n.name||"Component"),o.prototype.isReactComponent={},o.prototype.render=function(){return{$$typeof:O,type:this.MoizedComponent,props:this.props,ref:null,key:null,_owner:null}},E(n,o,["contextType","contextTypes"]),o.displayName="Moized("+(n.displayName||n.name||"Component")+")",l(o,n.name,t.profileName),o}(e,t,s);var m=i({},o,s,{maxAge:"number"==typeof s.maxAge&&s.maxAge>=0?s.maxAge:o.maxAge,maxArgs:"number"==typeof s.maxArgs&&s.maxArgs>=0?s.maxArgs:o.maxArgs,maxSize:"number"==typeof s.maxSize&&s.maxSize>=0?s.maxSize:o.maxSize,profileName:s.profileName||A(t)}),h=[];m.matchesArg,m.isDeepEqual;var d=m.isPromise;m.isReact,m.isSerialized,m.isShallowEqual,m.matchesKey,m.maxAge,m.maxArgs;var v=m.maxSize,z=m.onCacheAdd,S=m.onCacheChange,b=m.onCacheHit;m.onExpire,m.profileName,m.serializer;var N=m.updateCacheForKey;m.transformArgs,m.updateExpire;var q=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(m,P),w=function(e){return e.matchesArg||e.isDeepEqual&&n.deepEqual||e.isShallowEqual&&n.shallowEqual||n.sameValueZeroEqual}(m),F=function(e){return e.matchesKey||e.isSerialized&&K||void 0}(m),H=g(h,m,w,F),R=function(e){return y.isCollectingStats?{onCacheAdd:x(e),onCacheHit:C(e)}:{}}(m),_=M(m),D=i({},q,{isEqual:w,isMatchingKey:F,isPromise:d,maxSize:v,onCacheAdd:j(a(z,H.onCacheAdd,R.onCacheAdd)),onCacheChange:j(S),onCacheHit:j(a(b,H.onCacheHit,R.onCacheHit)),transformKey:_}),T=k(r.default(t,D),{expirations:h,options:m,originalFunction:t});return N&&(T=function(e){var n=e.options.updateCacheForKey,t=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(!n(r))return e.apply(this,r);var o=e.fn.apply(this,r);return e.set(r,o),o};return E(e,t),t}(T)),l(T,t.name,s.profileName),T};return F.clearStats=v,F.collectStats=function(e){void 0===e&&(e=!0),y.isCollectingStats=e},F.compose=function(){return u.apply(void 0,arguments)||F},F.deep=F({isDeepEqual:!0}),F.getStats=S,F.infinite=F({maxSize:1/0}),F.isCollectingStats=function(){return y.isCollectingStats},F.isMoized=function(e){return"function"==typeof e&&!!e.isMoized},F.matchesArg=function(e){return F({matchesArg:e})},F.matchesKey=function(e){return F({matchesKey:e})},F.maxAge=function(e,n){if(!0===n)return F({maxAge:e,updateExpire:n});if("object"==typeof n){var t=n.onExpire,r=n.updateExpire;return F({maxAge:e,onExpire:t,updateExpire:r})}return F("function"==typeof n?{maxAge:e,onExpire:n,updateExpire:!0}:{maxAge:e})},F.maxArgs=function(e){return F({maxArgs:e})},F.maxSize=function(e){return F({maxSize:e})},F.profile=function(e){return F({profileName:e})},F.promise=F({isPromise:!0,updateExpire:!0}),F.react=F({isReact:!0}),F.serialize=F({isSerialized:!0}),F.serializeWith=function(e){return F({isSerialized:!0,serializer:e})},F.shallow=F({isShallowEqual:!0}),F.transformArgs=function(e){return F({transformArgs:e})},F.updateCacheForKey=function(e){return F({updateCacheForKey:e})},Object.defineProperty(F,"default",{configurable:!1,enumerable:!1,value:F,writable:!1}),F}));
//# sourceMappingURL=moize.min.js.map
